<div id="filter-map">
    <div id="mapid" style="height:500px;"></div>

    <ul>
        {{offersArray[0].id}}
        <li v-for="offer in offersArray">
            <span> {{ offer.id }}</span>
        </li>
    </ul>
</div>




{% put scripts %}
<script>
    var app = new Vue({
        el: '#filter-map',
        data: {
            offersArray: [],
            offers: '{{ offers|raw }}',
        },

        computed: {

        },
        watch: {


        },
        methods: {

        },

        mounted: function() {
            var cities = L.layerGroup();
            this.offersArray = JSON.parse(this.offers);

            for (var i = 0; i < this.offersArray.length; i++)
            {

                let content = this.offersArray[i].name + '<br/>';
                content += 'Ahorro = ' + this.offersArray[i].spar + '<br/>';
                content += '<a href="/oferta/' + this.offersArray[i].id + '" target="_blank">Link</a>';

                let popup = L.popup({
                   closeButton: true,
                   className: 'map-popup',
                }).setContent(content);

                var greenIcon = L.icon({
                    className: this.offersArray[i].partner.partner_type.slug,
                    iconUrl: '/themes/app2share/assets/image/map/marker-icon.png',
                    iconSize:     [30, 38], // size of the icon
                    shadowSize:   [50, 64], // size of the shadow
                });

                L.marker(
                    [this.offersArray[i].partner.latitude, this.offersArray[i].partner.longitude], {icon: greenIcon}
                ).bindPopup(popup).addTo(cities);

            }


            var mbAttr = '',
                mbUrl = 'https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw';

            var streets  = L.tileLayer(mbUrl, {id: 'mapbox.streets',   attribution: mbAttr});

            var map = L.map('mapid', {
                center: [39.5695, 2.9459],
                zoom: 10,
                layers: [streets, cities]
            });

            var gps = new L.Control.Gps({
                autoActive:true,
                autoCenter:true
            });


            gps.addTo(map);

        }




    });
</script>
{% endput %}
