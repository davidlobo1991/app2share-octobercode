test123=1
==
<div id="mapid" style="height:500px;"></div>

<ul>
    {% for part in partner %}
        <li>{{part.name}}</li>
    {% endfor %}
</ul>




{% put scripts %}
<script>
    var cities = L.layerGroup();

   var test = '{{ partner|raw }}';

   var as = JSON.parse(test);

   for (var i = 0; i < as.length; i++)
   {
       let popup = as[i].name;
       popup += '<br/>';

       for (var j = 0; j < as[i].offer.length; j++) {
           popup += as[i].offer[j].name + '<br/>';
           popup += 'Ahorro = ' + as[i].offer[j].spar + '<br/>';

           popup += '<a href="/oferta/'+as[i].offer[j].id+'" target="_blank">Link</a>';
       }

       L.marker([as[i].latitude, as[i].longitude]).bindPopup(popup).addTo(cities);

   }


   var mbAttr = 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
       '<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
       'Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
       mbUrl = 'https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw';

   var streets  = L.tileLayer(mbUrl, {id: 'mapbox.streets',   attribution: mbAttr});

   var map = L.map('mapid', {
       center: [39.5695, 2.9459],
       zoom: 10,
       layers: [streets, cities]
   });

   var gps = new L.Control.Gps({
       autoActive:true,
       autoCenter:true
   });


   gps.addTo(map);

</script>
{% endput %}