
{% partial 'useroffer/button' %}

<!-- Modal -->
<div class="control-popup modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">{{offer.name}}</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                {{offer.description|raw}}
                <p>Podr√°s volver a usar la oferta en 24 horas</p>

            </div>
            <div class="modal-footer">
                {% if user %}
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                    <form data-request-flash data-request="{{ __SELF__ }}::onUserOffer"
                          data-request-data="[offer_id: {{offer.id}}]"
                          data-request-update="'useroffer/button': '#btn-offer'"
                          data-request-success="closeModal(); countdownTimeStart(data.validTo.date);">

                        <button type="submit" class="btn btn-primary">Usar oferta</button>
                    </form>
                {% else %}
                    <p><a href="/login">Logueate</a> para poder usar la oferta (por ahora todos los usuarios)</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>


<script>
    function closeModal() {
        $('#exampleModal').modal('hide');
    }

    function countdownTimeStart(data) {
        console.log(data);
        let countDownDate = new Date(data).getTime();

        let x = setInterval(function() {

            // Get todays date and time
            let now = new Date().getTime();

            // Find the distance between now an the count down date
            let distance = countDownDate - now;

            // Time calculations for days, hours, minutes and seconds
            let hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            let minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            let seconds = Math.floor((distance % (1000 * 60)) / 1000);

            document.getElementById("timer").innerHTML = hours + "h "
                + minutes + "m " + seconds + "s ";

            if (distance < 0) {
                clearInterval(x);
                document.getElementById("timer").innerHTML = "EXPIRED";
            }
        }, 1000);
    }
</script>

{% if offerUser %}
<script>
    countdownTimeStart("{{offerUser.valid_to}}");
</script>
{% endif %}

